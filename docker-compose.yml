services:
  # --- Original Services (Distributed Architecture) ---
  litellm:
    image: ghcr.io/berriai/litellm:main-latest
    ports:
      - "4000:4000"
    volumes:
      - ./litellm_config.yaml:/app/config.yaml
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    command: [ "--config", "/app/config.yaml", "--port", "4000", "--detailed_debug" ]

  router:
    build: ./claude-code-router
    ports:
      - "3000:3000"
    volumes:
      - ./claude-code-router/config.json:/root/.claude-code-router/config.json
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}

  claude-code:
    build: .
    volumes:
      - .:/app
      - claude-config:/root/.local/share/claude
      - claude-config-local:/root/.local/state/claude
    environment:
      - ANTHROPIC_BASE_URL=${ANTHROPIC_BASE_URL}
      - ANTHROPIC_AUTH_TOKEN=sk-dummy-key
    tty: true
    stdin_open: true

  # --- New Fused Services (Self-Contained) ---
  
  fused-litellm:
    build: 
      context: .
      dockerfile: Dockerfile.fused-litellm
    volumes:
      - .:/app
      - ./litellm_config.yaml:/app/config.yaml
      - claude-config:/root/.local/share/claude
      - claude-config-local:/root/.local/state/claude
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    tty: true
    stdin_open: true

  fused-router:
    build:
      context: .
      dockerfile: Dockerfile.fused-router
    volumes:
      - .:/app
      - ./claude-code-router/config.json:/root/.claude-code-router/config.json
      - claude-config:/root/.local/share/claude
      - claude-config-local:/root/.local/state/claude
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
    tty: true
    stdin_open: true

volumes:
  claude-config:
  claude-config-local: